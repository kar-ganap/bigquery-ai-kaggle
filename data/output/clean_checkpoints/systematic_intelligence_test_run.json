{
  "brand": "Warby Parker",
  "run_id": "test_run",
  "timestamp": 1758503450.8931699,
  "level_1": {
    "executive_insights": [
      "Creative text length optimization needed - content is too brief for engagement - declining performance over 4 weeks, immediate action required"
    ],
    "critical_metrics": {
      "creative_text_length_short": 0
    },
    "threat_level": "MEDIUM",
    "confidence_score": 0.8,
    "signal_count": 1,
    "filtered_signals": 0
  },
  "level_2": {
    "strategic_intelligence": {
      "Creative Intelligence": {
        "insights": [
          "Creative text length optimization needed - content is too brief for engagement - declining performance over 4 weeks, immediate action required",
          "Low brand mention frequency detected - increase brand presence in creative content - concerning downward trend over 6 weeks",
          "Limited emotional language detected - incorporate more engaging emotional keywords"
        ],
        "key_metrics": {
          "creative_intelligence_0": 0,
          "creative_intelligence_1": 0,
          "creative_intelligence_2": 0
        },
        "confidence_avg": 0.7000000000000001,
        "business_impact_avg": 0.7000000000000001,
        "signal_count": 3
      }
    },
    "cross_module_patterns": [
      "Multi-dimensional intelligence active: Creative modules provide comprehensive competitive analysis"
    ],
    "strategic_priorities": [
      "Creative Intelligence: Low brand mention frequency detected - increase brand presence in creative content - concerning down...",
      "Creative Intelligence: Creative text length optimization needed - content is too brief for engagement - declining performan..."
    ],
    "total_signals": 3,
    "modules_active": 1
  },
  "level_3": {
    "immediate_actions": [],
    "short_term_tactics": [
      {
        "action": "Creative text length optimization needed - content is too brief for engagement - declining performance over 4 weeks, immediate action required",
        "rationale": "Based on Creative Intelligence analysis",
        "confidence": 0.8,
        "business_impact": 0.7,
        "actionability": 0.9,
        "timeline": "Short-term (2-4 weeks)",
        "success_metrics": [
          "Implementation completion rate",
          "Average creative text length",
          "Content engagement rate"
        ],
        "source_module": "Creative Intelligence",
        "value": 0,
        "priority": "HIGH"
      },
      {
        "action": "Low brand mention frequency detected - increase brand presence in creative content - concerning downward trend over 6 weeks",
        "rationale": "Based on Creative Intelligence analysis",
        "confidence": 0.7,
        "business_impact": 0.8,
        "actionability": 0.8,
        "timeline": "Short-term (2-4 weeks)",
        "success_metrics": [
          "Implementation completion rate",
          "Creative performance score",
          "Brand message consistency"
        ],
        "source_module": "Creative Intelligence",
        "value": 0,
        "priority": "HIGH"
      },
      {
        "action": "Limited emotional language detected - incorporate more engaging emotional keywords",
        "rationale": "Based on Creative Intelligence analysis",
        "confidence": 0.6,
        "business_impact": 0.6,
        "actionability": 0.7,
        "timeline": "Short-term (2-4 weeks)",
        "success_metrics": [
          "Implementation completion rate",
          "Emotional keyword usage rate",
          "Brand sentiment score"
        ],
        "source_module": "Creative Intelligence",
        "value": 0,
        "priority": "HIGH"
      }
    ],
    "monitoring_actions": [
      {
        "action": "Content density optimization opportunity - enrich creative messaging",
        "rationale": "Based on Creative Intelligence analysis",
        "confidence": 0.5,
        "business_impact": 0.5,
        "actionability": 0.6,
        "timeline": "Medium-term (4-8 weeks)",
        "success_metrics": [
          "Implementation completion rate",
          "Creative performance score",
          "Brand message consistency"
        ],
        "source_module": "Creative Intelligence",
        "value": 0,
        "priority": "MEDIUM"
      }
    ],
    "intervention_summary": {
      "total_interventions": 4,
      "immediate_count": 0,
      "short_term_count": 3,
      "monitoring_count": 1,
      "avg_confidence": 0.65,
      "avg_actionability": 0.7500000000000001
    }
  },
  "level_4": {
    "bigquery_project": "bigquery-ai-kaggle-469620",
    "bigquery_dataset": "ads_demo",
    "dashboard_queries": {
      "creative_intelligence_analysis": "\n            -- Creative Intelligence Dashboard with Temporal Analysis (Phase 1)\n            WITH weekly_creative_metrics AS (\n              SELECT\n                brand,\n                DATE_TRUNC(DATE(start_timestamp), WEEK(MONDAY)) as week_start,\n                COUNT(*) as weekly_ads,\n                AVG(LENGTH(COALESCE(creative_text, ''))) as avg_creative_length,\n                COUNT(DISTINCT REGEXP_EXTRACT(creative_text, r'\\b(\\w+)\\b')) as unique_words,\n                SUM(CASE WHEN creative_text LIKE '%!%' THEN 1 ELSE 0 END) as exclamation_ads,\n                AVG(CASE WHEN LENGTH(creative_text) > 100 THEN 1.0 ELSE 0.0 END) as long_form_rate,\n                AVG(CASE\n                  WHEN LENGTH(COALESCE(creative_text, '')) > 150 THEN 3\n                  WHEN LENGTH(COALESCE(creative_text, '')) > 75 THEN 2\n                  ELSE 1\n                END) as text_length_score,\n                AVG(\n                  (LENGTH(UPPER(COALESCE(creative_text, ''))) - LENGTH(REPLACE(UPPER(COALESCE(creative_text, '')), brand, ''))) /\n                  GREATEST(LENGTH(brand), 1)\n                ) as brand_mention_density\n              FROM `bigquery-ai-kaggle-469620.ads_demo.ads_with_dates`\n              WHERE creative_text IS NOT NULL\n                AND start_timestamp >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 12 WEEK)\n              GROUP BY brand, week_start\n            ),\n            temporal_analysis AS (\n              SELECT\n                brand,\n                week_start,\n                weekly_ads,\n                avg_creative_length,\n                text_length_score,\n                brand_mention_density,\n                -- Week-over-week changes\n                LAG(weekly_ads) OVER (PARTITION BY brand ORDER BY week_start) as prev_week_ads,\n                LAG(avg_creative_length) OVER (PARTITION BY brand ORDER BY week_start) as prev_week_length,\n                LAG(text_length_score) OVER (PARTITION BY brand ORDER BY week_start) as prev_week_text_score,\n                -- Competitive ranking\n                RANK() OVER (PARTITION BY week_start ORDER BY weekly_ads DESC) as weekly_volume_rank,\n                RANK() OVER (PARTITION BY week_start ORDER BY avg_creative_length DESC) as weekly_length_rank,\n                LAG(RANK() OVER (PARTITION BY week_start ORDER BY weekly_ads DESC)) OVER (PARTITION BY brand ORDER BY week_start) as prev_volume_rank\n              FROM weekly_creative_metrics\n            ),\n            creative_summary AS (\n              SELECT\n                brand,\n                COUNT(DISTINCT week_start) as weeks_active,\n                SUM(weekly_ads) as total_ads,\n                AVG(avg_creative_length) as avg_creative_length,\n                AVG(text_length_score) as avg_text_score,\n                AVG(brand_mention_density) as avg_brand_density,\n                -- Temporal insights\n                AVG(weekly_ads - COALESCE(prev_week_ads, weekly_ads)) as avg_weekly_volume_change,\n                AVG(avg_creative_length - COALESCE(prev_week_length, avg_creative_length)) as avg_weekly_length_change,\n                AVG(weekly_volume_rank) as avg_volume_rank,\n                MIN(weekly_volume_rank) as best_volume_rank,\n                MAX(weekly_volume_rank) as worst_volume_rank,\n                -- Trend indicators\n                CASE\n                  WHEN AVG(weekly_ads - COALESCE(prev_week_ads, weekly_ads)) > 2 THEN 'INCREASING_VOLUME'\n                  WHEN AVG(weekly_ads - COALESCE(prev_week_ads, weekly_ads)) < -2 THEN 'DECREASING_VOLUME'\n                  ELSE 'STABLE_VOLUME'\n                END as volume_trend,\n                CASE\n                  WHEN AVG(avg_creative_length - COALESCE(prev_week_length, avg_creative_length)) > 10 THEN 'LENGTHENING_CONTENT'\n                  WHEN AVG(avg_creative_length - COALESCE(prev_week_length, avg_creative_length)) < -10 THEN 'SHORTENING_CONTENT'\n                  ELSE 'STABLE_LENGTH'\n                END as content_trend\n              FROM temporal_analysis\n              GROUP BY brand\n            )\n            SELECT\n              brand,\n              weeks_active,\n              total_ads,\n              ROUND(avg_creative_length, 1) as avg_creative_length,\n              ROUND(avg_text_score, 2) as text_optimization_score,\n              ROUND(avg_brand_density, 3) as brand_mention_density,\n              -- Temporal intelligence\n              ROUND(avg_weekly_volume_change, 1) as avg_weekly_volume_change,\n              ROUND(avg_weekly_length_change, 1) as avg_weekly_length_change,\n              ROUND(avg_volume_rank, 1) as avg_competitive_rank,\n              volume_trend,\n              content_trend,\n              -- Competitive positioning\n              CASE\n                WHEN avg_volume_rank <= 2 THEN 'MARKET_LEADER'\n                WHEN avg_volume_rank <= 4 THEN 'STRONG_PLAYER'\n                ELSE 'CHALLENGER'\n              END as competitive_position,\n              -- Movement indicator\n              CASE\n                WHEN best_volume_rank < worst_volume_rank THEN 'IMPROVING_POSITION'\n                WHEN best_volume_rank > worst_volume_rank THEN 'DECLINING_POSITION'\n                ELSE 'STABLE_POSITION'\n              END as competitive_movement\n            FROM creative_summary\n            ORDER BY total_ads DESC\n            ",
      "competitive_velocity_analysis": "\n        -- Competitive Velocity Analysis Dashboard (Phase 2)\n        -- Measures acceleration and deceleration across all intelligence dimensions\n\n        WITH weekly_intelligence_metrics AS (\n          SELECT\n            brand,\n            DATE_TRUNC(DATE(start_timestamp), WEEK(MONDAY)) as week_start,\n\n            -- Creative Velocity Metrics\n            COUNT(*) as weekly_ads,\n            AVG(LENGTH(COALESCE(creative_text, ''))) as avg_creative_length,\n            COUNT(DISTINCT REGEXP_EXTRACT(creative_text, r'\\b(\\w+)\\b')) as unique_creative_words,\n\n            -- Channel Momentum Metrics\n            COUNT(DISTINCT media_type) as channel_diversity,\n            AVG(ARRAY_LENGTH(platforms_array)) as avg_platform_reach,\n            SUM(CASE WHEN media_type = 'VIDEO' THEN 1 ELSE 0 END) as video_ads,\n\n            -- Visual Evolution Metrics\n            AVG(CASE WHEN LENGTH(creative_text) > 100 THEN 1.0 ELSE 0.0 END) as long_form_rate,\n            AVG(duration_quality_weight) as avg_quality_score\n\n          FROM `bigquery-ai-kaggle-469620.ads_demo.ads_with_dates`\n          WHERE creative_text IS NOT NULL\n            AND start_timestamp >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 16 WEEK)\n          GROUP BY brand, week_start\n        ),\n\n        velocity_calculations AS (\n          SELECT\n            brand,\n            week_start,\n            weekly_ads,\n            avg_creative_length,\n            unique_creative_words,\n            channel_diversity,\n            avg_platform_reach,\n            video_ads,\n            long_form_rate,\n            avg_quality_score,\n\n            -- Creative Velocity: Rate of change in creative output\n            (weekly_ads - LAG(weekly_ads, 1) OVER (PARTITION BY brand ORDER BY week_start)) as creative_volume_velocity_1w,\n            (weekly_ads - LAG(weekly_ads, 4) OVER (PARTITION BY brand ORDER BY week_start)) / 4.0 as creative_volume_velocity_4w,\n\n            -- Creative Sophistication Velocity\n            (avg_creative_length - LAG(avg_creative_length, 1) OVER (PARTITION BY brand ORDER BY week_start)) as creative_length_velocity_1w,\n            (unique_creative_words - LAG(unique_creative_words, 1) OVER (PARTITION BY brand ORDER BY week_start)) as creative_diversity_velocity_1w,\n\n            -- Channel Momentum: Rate of platform expansion\n            (avg_platform_reach - LAG(avg_platform_reach, 1) OVER (PARTITION BY brand ORDER BY week_start)) as platform_momentum_1w,\n            (channel_diversity - LAG(channel_diversity, 1) OVER (PARTITION BY brand ORDER BY week_start)) as channel_expansion_velocity_1w,\n\n            -- Visual Evolution Speed\n            (video_ads - LAG(video_ads, 1) OVER (PARTITION BY brand ORDER BY week_start)) as video_adoption_velocity_1w,\n            (long_form_rate - LAG(long_form_rate, 1) OVER (PARTITION BY brand ORDER BY week_start)) as content_sophistication_velocity_1w\n\n          FROM weekly_intelligence_metrics\n        ),\n\n        competitive_velocity_ranking AS (\n          SELECT\n            *,\n\n            -- Current week competitive velocity rankings\n            RANK() OVER (PARTITION BY week_start ORDER BY ABS(COALESCE(creative_volume_velocity_1w, 0)) DESC) as creative_velocity_rank,\n            RANK() OVER (PARTITION BY week_start ORDER BY ABS(COALESCE(platform_momentum_1w, 0)) DESC) as platform_momentum_rank,\n            RANK() OVER (PARTITION BY week_start ORDER BY ABS(COALESCE(channel_expansion_velocity_1w, 0)) DESC) as channel_velocity_rank,\n            RANK() OVER (PARTITION BY week_start ORDER BY ABS(COALESCE(video_adoption_velocity_1w, 0)) DESC) as visual_velocity_rank,\n\n            -- Velocity classification\n            CASE\n              WHEN COALESCE(creative_volume_velocity_1w, 0) >= 5 THEN 'ACCELERATING_FAST'\n              WHEN COALESCE(creative_volume_velocity_1w, 0) >= 2 THEN 'ACCELERATING'\n              WHEN COALESCE(creative_volume_velocity_1w, 0) <= -5 THEN 'DECELERATING_FAST'\n              WHEN COALESCE(creative_volume_velocity_1w, 0) <= -2 THEN 'DECELERATING'\n              ELSE 'STABLE_VELOCITY'\n            END as creative_velocity_classification,\n\n            CASE\n              WHEN COALESCE(platform_momentum_1w, 0) >= 1.0 THEN 'EXPANDING_FAST'\n              WHEN COALESCE(platform_momentum_1w, 0) >= 0.5 THEN 'EXPANDING'\n              WHEN COALESCE(platform_momentum_1w, 0) <= -1.0 THEN 'CONTRACTING_FAST'\n              WHEN COALESCE(platform_momentum_1w, 0) <= -0.5 THEN 'CONTRACTING'\n              ELSE 'STABLE_REACH'\n            END as platform_momentum_classification\n\n          FROM velocity_calculations\n        ),\n\n        velocity_summary AS (\n          SELECT\n            brand,\n            week_start,\n\n            -- Current metrics\n            weekly_ads,\n            ROUND(avg_creative_length, 1) as avg_creative_length,\n            unique_creative_words,\n            channel_diversity,\n            ROUND(avg_platform_reach, 1) as avg_platform_reach,\n            video_ads,\n            ROUND(long_form_rate * 100, 1) as long_form_pct,\n            ROUND(avg_quality_score, 3) as avg_quality_score,\n\n            -- Velocity metrics (1-week)\n            ROUND(COALESCE(creative_volume_velocity_1w, 0), 1) as creative_volume_velocity_1w,\n            ROUND(COALESCE(creative_length_velocity_1w, 0), 1) as creative_length_velocity_1w,\n            ROUND(COALESCE(creative_diversity_velocity_1w, 0), 1) as creative_diversity_velocity_1w,\n            ROUND(COALESCE(platform_momentum_1w, 0), 2) as platform_momentum_1w,\n            ROUND(COALESCE(channel_expansion_velocity_1w, 0), 1) as channel_expansion_velocity_1w,\n            ROUND(COALESCE(video_adoption_velocity_1w, 0), 1) as video_adoption_velocity_1w,\n            ROUND(COALESCE(content_sophistication_velocity_1w, 0), 3) as content_sophistication_velocity_1w,\n\n            -- Velocity metrics (4-week trend)\n            ROUND(COALESCE(creative_volume_velocity_4w, 0), 2) as creative_volume_velocity_4w,\n\n            -- Competitive rankings\n            creative_velocity_rank,\n            platform_momentum_rank,\n            channel_velocity_rank,\n            visual_velocity_rank,\n\n            -- Classifications\n            creative_velocity_classification,\n            platform_momentum_classification,\n\n            -- Overall velocity score (composite of all dimensions)\n            ROUND((\n              ABS(COALESCE(creative_volume_velocity_1w, 0)) * 0.3 +\n              ABS(COALESCE(platform_momentum_1w, 0)) * 10 * 0.3 +  -- Scale platform momentum\n              ABS(COALESCE(channel_expansion_velocity_1w, 0)) * 0.2 +\n              ABS(COALESCE(video_adoption_velocity_1w, 0)) * 0.2\n            ), 2) as overall_velocity_score,\n\n            -- Strategic velocity insight\n            CASE\n              WHEN creative_velocity_rank <= 2 AND platform_momentum_rank <= 2 THEN 'MULTI_DIMENSIONAL_LEADER'\n              WHEN creative_velocity_rank <= 2 THEN 'CREATIVE_VELOCITY_LEADER'\n              WHEN platform_momentum_rank <= 2 THEN 'PLATFORM_MOMENTUM_LEADER'\n              WHEN channel_velocity_rank <= 2 THEN 'CHANNEL_EXPANSION_LEADER'\n              WHEN visual_velocity_rank <= 2 THEN 'VISUAL_EVOLUTION_LEADER'\n              ELSE 'STABLE_STRATEGIC_POSITION'\n            END as velocity_leadership_type\n\n          FROM competitive_velocity_ranking\n        )\n\n        SELECT *\n        FROM velocity_summary\n        WHERE week_start >= DATE_SUB(CURRENT_DATE(), INTERVAL 12 WEEK)  -- Last 12 weeks\n        ORDER BY week_start DESC, overall_velocity_score DESC\n        ",
      "strategic_inflection_detection": "\n        -- Strategic Inflection Detection Dashboard (Phase 3)\n        -- Identifies when competitive dynamics shifted significantly\n\n        WITH weekly_metrics AS (\n          SELECT\n            brand,\n            DATE_TRUNC(DATE(start_timestamp), WEEK(MONDAY)) as week_start,\n\n            -- Core strategic metrics\n            COUNT(*) as weekly_ads,\n            AVG(LENGTH(COALESCE(creative_text, ''))) as avg_creative_length,\n            COUNT(DISTINCT media_type) as media_diversity,\n            AVG(ARRAY_LENGTH(platforms_array)) as avg_platform_reach,\n            SUM(CASE WHEN media_type = 'VIDEO' THEN 1 ELSE 0 END) / COUNT(*) as video_ratio,\n            AVG(duration_quality_weight) as avg_quality,\n\n            -- Text sophistication metrics\n            AVG(CASE WHEN creative_text LIKE '%limited%' OR creative_text LIKE '%exclusive%'\n                     OR creative_text LIKE '%sale%' THEN 1 ELSE 0 END) as urgency_ratio,\n            AVG(CASE WHEN creative_text LIKE '%free%' OR creative_text LIKE '%discount%'\n                     OR creative_text LIKE '%off%' THEN 1 ELSE 0 END) as promo_ratio\n\n          FROM `bigquery-ai-kaggle-469620.ads_demo.ads_with_dates`\n          WHERE creative_text IS NOT NULL\n            AND start_timestamp >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 20 WEEK)\n          GROUP BY brand, week_start\n        ),\n\n        inflection_detection AS (\n          SELECT\n            brand,\n            week_start,\n            weekly_ads,\n            avg_creative_length,\n            media_diversity,\n            avg_platform_reach,\n            video_ratio,\n            avg_quality,\n            urgency_ratio,\n            promo_ratio,\n\n            -- Calculate rolling averages for stability baseline\n            AVG(weekly_ads) OVER (\n              PARTITION BY brand\n              ORDER BY week_start\n              ROWS BETWEEN 4 PRECEDING AND 1 PRECEDING\n            ) as rolling_avg_ads_4w,\n\n            STDDEV(weekly_ads) OVER (\n              PARTITION BY brand\n              ORDER BY week_start\n              ROWS BETWEEN 4 PRECEDING AND 1 PRECEDING\n            ) as rolling_stddev_ads_4w,\n\n            -- Media strategy baseline\n            AVG(video_ratio) OVER (\n              PARTITION BY brand\n              ORDER BY week_start\n              ROWS BETWEEN 4 PRECEDING AND 1 PRECEDING\n            ) as rolling_avg_video_ratio_4w,\n\n            -- Platform strategy baseline\n            AVG(avg_platform_reach) OVER (\n              PARTITION BY brand\n              ORDER BY week_start\n              ROWS BETWEEN 4 PRECEDING AND 1 PRECEDING\n            ) as rolling_avg_platform_4w,\n\n            -- Creative strategy baseline\n            AVG(avg_creative_length) OVER (\n              PARTITION BY brand\n              ORDER BY week_start\n              ROWS BETWEEN 4 PRECEDING AND 1 PRECEDING\n            ) as rolling_avg_creative_length_4w\n\n          FROM weekly_metrics\n        ),\n\n        anomaly_detection AS (\n          SELECT\n            *,\n\n            -- Volume anomaly detection (2 standard deviations)\n            CASE\n              WHEN ABS(weekly_ads - COALESCE(rolling_avg_ads_4w, weekly_ads)) >\n                   2 * COALESCE(rolling_stddev_ads_4w, 0.001) THEN 1\n              ELSE 0\n            END as volume_anomaly,\n\n            -- Media strategy shift detection (>30% change)\n            CASE\n              WHEN ABS(video_ratio - COALESCE(rolling_avg_video_ratio_4w, video_ratio)) > 0.3 THEN 1\n              ELSE 0\n            END as media_strategy_shift,\n\n            -- Platform expansion detection (>1.5 platform change)\n            CASE\n              WHEN ABS(avg_platform_reach - COALESCE(rolling_avg_platform_4w, avg_platform_reach)) > 1.5 THEN 1\n              ELSE 0\n            END as platform_strategy_shift,\n\n            -- Creative evolution detection (>50 char average change)\n            CASE\n              WHEN ABS(avg_creative_length - COALESCE(rolling_avg_creative_length_4w, avg_creative_length)) > 50 THEN 1\n              ELSE 0\n            END as creative_strategy_shift,\n\n            -- Calculate Z-scores for magnitude\n            SAFE_DIVIDE(\n              weekly_ads - COALESCE(rolling_avg_ads_4w, weekly_ads),\n              COALESCE(rolling_stddev_ads_4w, 1)\n            ) as volume_z_score\n\n          FROM inflection_detection\n        ),\n\n        competitive_responses AS (\n          SELECT\n            a.brand,\n            a.week_start,\n            a.weekly_ads,\n            a.volume_anomaly,\n            a.media_strategy_shift,\n            a.platform_strategy_shift,\n            a.creative_strategy_shift,\n            a.volume_z_score,\n\n            -- Check if competitors had inflections in the same or following week\n            SUM(CASE\n              WHEN b.brand != a.brand AND b.volume_anomaly = 1\n                   AND b.week_start BETWEEN a.week_start AND DATE_ADD(a.week_start, INTERVAL 2 WEEK)\n              THEN 1 ELSE 0\n            END) as competitive_response_count,\n\n            -- Identify market-wide shifts\n            SUM(CASE\n              WHEN b.week_start = a.week_start AND (\n                b.volume_anomaly = 1 OR\n                b.media_strategy_shift = 1 OR\n                b.platform_strategy_shift = 1\n              ) THEN 1 ELSE 0\n            END) as market_shift_breadth\n\n          FROM anomaly_detection a\n          CROSS JOIN anomaly_detection b\n          GROUP BY 1,2,3,4,5,6,7,8\n        ),\n\n        inflection_summary AS (\n          SELECT\n            brand,\n            week_start,\n            weekly_ads,\n            ROUND(volume_z_score, 2) as volume_z_score,\n\n            -- Strategic shift indicators\n            volume_anomaly,\n            media_strategy_shift,\n            platform_strategy_shift,\n            creative_strategy_shift,\n\n            -- Total strategic changes this week\n            (volume_anomaly + media_strategy_shift + platform_strategy_shift + creative_strategy_shift) as total_shifts,\n\n            -- Competitive dynamics\n            competitive_response_count,\n            market_shift_breadth,\n\n            -- Classify inflection type\n            CASE\n              WHEN (volume_anomaly + media_strategy_shift + platform_strategy_shift + creative_strategy_shift) >= 3\n                THEN 'MAJOR_STRATEGIC_PIVOT'\n              WHEN (volume_anomaly + media_strategy_shift + platform_strategy_shift + creative_strategy_shift) >= 2\n                THEN 'SIGNIFICANT_ADJUSTMENT'\n              WHEN volume_anomaly = 1 AND volume_z_score > 3\n                THEN 'VOLUME_SURGE'\n              WHEN volume_anomaly = 1 AND volume_z_score < -3\n                THEN 'VOLUME_COLLAPSE'\n              WHEN media_strategy_shift = 1\n                THEN 'MEDIA_STRATEGY_CHANGE'\n              WHEN platform_strategy_shift = 1\n                THEN 'PLATFORM_EXPANSION'\n              WHEN creative_strategy_shift = 1\n                THEN 'CREATIVE_EVOLUTION'\n              ELSE 'STABLE_STRATEGY'\n            END as inflection_type,\n\n            -- Competitive response pattern\n            CASE\n              WHEN competitive_response_count >= 3 THEN 'TRIGGERED_MARKET_RESPONSE'\n              WHEN competitive_response_count >= 1 THEN 'PROMPTED_COMPETITOR_ACTION'\n              WHEN market_shift_breadth >= 4 THEN 'PART_OF_MARKET_SHIFT'\n              WHEN market_shift_breadth >= 2 THEN 'ALIGNED_WITH_TREND'\n              ELSE 'INDEPENDENT_MOVE'\n            END as competitive_context,\n\n            -- Strategic importance score\n            ROUND(\n              ABS(COALESCE(volume_z_score, 0)) * 0.3 +\n              (volume_anomaly + media_strategy_shift + platform_strategy_shift + creative_strategy_shift) * 2 +\n              LEAST(competitive_response_count, 3) * 0.5 +\n              LEAST(market_shift_breadth, 5) * 0.2\n            , 2) as inflection_importance_score\n\n          FROM competitive_responses\n        )\n\n        SELECT\n          brand,\n          week_start,\n          weekly_ads,\n          volume_z_score,\n          inflection_type,\n          competitive_context,\n          inflection_importance_score,\n          total_shifts,\n          competitive_response_count,\n          market_shift_breadth,\n\n          -- Strategic shift details\n          CASE WHEN volume_anomaly = 1 THEN 'VOLUME' ELSE NULL END as volume_shift,\n          CASE WHEN media_strategy_shift = 1 THEN 'MEDIA' ELSE NULL END as media_shift,\n          CASE WHEN platform_strategy_shift = 1 THEN 'PLATFORM' ELSE NULL END as platform_shift,\n          CASE WHEN creative_strategy_shift = 1 THEN 'CREATIVE' ELSE NULL END as creative_shift\n\n        FROM inflection_summary\n        WHERE week_start >= DATE_SUB(CURRENT_DATE(), INTERVAL 16 WEEK)\n          AND inflection_type != 'STABLE_STRATEGY'  -- Only show actual inflections\n        ORDER BY inflection_importance_score DESC, week_start DESC\n        ",
      "predictive_competitive_forecast": "\n        -- Predictive Competitive Forecast Dashboard (Phase 4)\n        -- Integrates ML.FORECAST models with current competitive intelligence\n\n        WITH current_competitive_state AS (\n          SELECT\n            brand,\n            DATE_TRUNC(DATE(start_timestamp), WEEK(MONDAY)) as week_start,\n            COUNT(*) as current_weekly_ads,\n            AVG(duration_quality_weight) as current_avg_quality,\n            COUNT(DISTINCT media_type) as current_media_diversity,\n            AVG(ARRAY_LENGTH(platforms_array)) as current_platform_reach,\n            SUM(CASE WHEN media_type = 'VIDEO' THEN 1 ELSE 0 END) / COUNT(*) * 100 as current_video_pct\n\n          FROM `bigquery-ai-kaggle-469620.ads_demo.ads_with_dates`\n          WHERE creative_text IS NOT NULL\n            AND start_timestamp >= TIMESTAMP_SUB(CURRENT_TIMESTAMP(), INTERVAL 8 WEEK)\n          GROUP BY brand, week_start\n        ),\n\n        -- Get latest actual values for comparison baseline\n        latest_actuals AS (\n          SELECT\n            brand,\n            MAX(week_start) as latest_week,\n            ARRAY_AGG(current_weekly_ads ORDER BY week_start DESC LIMIT 1)[OFFSET(0)] as latest_weekly_ads,\n            ARRAY_AGG(current_avg_quality ORDER BY week_start DESC LIMIT 1)[OFFSET(0)] as latest_avg_quality,\n            ARRAY_AGG(current_platform_reach ORDER BY week_start DESC LIMIT 1)[OFFSET(0)] as latest_platform_reach,\n            ARRAY_AGG(current_video_pct ORDER BY week_start DESC LIMIT 1)[OFFSET(0)] as latest_video_pct\n          FROM current_competitive_state\n          GROUP BY brand\n        ),\n\n        -- ML.FORECAST Volume Predictions (4-week horizon)\n        volume_forecasts AS (\n          SELECT\n            forecast_timestamp,\n            brand_id as brand,\n            forecast_value as predicted_weekly_ads,\n            prediction_interval_lower_bound as ads_lower_bound,\n            prediction_interval_upper_bound as ads_upper_bound,\n            confidence_level\n          FROM ML.FORECAST(MODEL `bigquery-ai-kaggle-469620.ads_demo.forecast_ad_volume`,\n                          STRUCT(4 as horizon))\n          WHERE forecast_timestamp > CURRENT_DATE()\n        ),\n\n        -- ML.FORECAST Aggressiveness Predictions\n        aggressiveness_forecasts AS (\n          SELECT\n            forecast_timestamp,\n            brand_id as brand,\n            forecast_value as predicted_aggressiveness,\n            prediction_interval_lower_bound as aggressiveness_lower,\n            prediction_interval_upper_bound as aggressiveness_upper\n          FROM ML.FORECAST(MODEL `bigquery-ai-kaggle-469620.ads_demo.forecast_aggressiveness`,\n                          STRUCT(4 as horizon))\n          WHERE forecast_timestamp > CURRENT_DATE()\n        ),\n\n        -- ML.FORECAST Cross-Platform Predictions\n        platform_forecasts AS (\n          SELECT\n            forecast_timestamp,\n            brand_id as brand,\n            forecast_value as predicted_cross_platform_pct,\n            prediction_interval_lower_bound as platform_lower,\n            prediction_interval_upper_bound as platform_upper\n          FROM ML.FORECAST(MODEL `bigquery-ai-kaggle-469620.ads_demo.forecast_cross_platform`,\n                          STRUCT(4 as horizon))\n          WHERE forecast_timestamp > CURRENT_DATE()\n        ),\n\n        -- Combine all forecasts with current state\n        integrated_forecasts AS (\n          SELECT\n            v.forecast_timestamp,\n            v.brand,\n\n            -- Current baseline (latest actuals)\n            l.latest_weekly_ads,\n            l.latest_avg_quality,\n            l.latest_platform_reach,\n            l.latest_video_pct,\n\n            -- Volume forecasts\n            ROUND(v.predicted_weekly_ads, 1) as predicted_weekly_ads,\n            ROUND(v.ads_lower_bound, 1) as ads_lower_bound,\n            ROUND(v.ads_upper_bound, 1) as ads_upper_bound,\n            v.confidence_level,\n\n            -- Aggressiveness forecasts\n            ROUND(COALESCE(a.predicted_aggressiveness, l.latest_avg_quality), 3) as predicted_aggressiveness,\n            ROUND(COALESCE(a.aggressiveness_lower, l.latest_avg_quality * 0.9), 3) as aggressiveness_lower,\n            ROUND(COALESCE(a.aggressiveness_upper, l.latest_avg_quality * 1.1), 3) as aggressiveness_upper,\n\n            -- Platform forecasts\n            ROUND(COALESCE(p.predicted_cross_platform_pct, l.latest_platform_reach), 2) as predicted_platform_reach,\n            ROUND(COALESCE(p.platform_lower, l.latest_platform_reach * 0.8), 2) as platform_lower,\n            ROUND(COALESCE(p.platform_upper, l.latest_platform_reach * 1.2), 2) as platform_upper,\n\n            -- Calculate predicted changes from current state\n            ROUND(v.predicted_weekly_ads - l.latest_weekly_ads, 1) as predicted_volume_change,\n            ROUND((v.predicted_weekly_ads - l.latest_weekly_ads) / NULLIF(l.latest_weekly_ads, 0) * 100, 1) as predicted_volume_change_pct,\n\n            -- Strategic prediction categories\n            CASE\n              WHEN v.predicted_weekly_ads > l.latest_weekly_ads * 1.2 THEN 'SIGNIFICANT_EXPANSION'\n              WHEN v.predicted_weekly_ads > l.latest_weekly_ads * 1.1 THEN 'MODERATE_GROWTH'\n              WHEN v.predicted_weekly_ads < l.latest_weekly_ads * 0.8 THEN 'SIGNIFICANT_CONTRACTION'\n              WHEN v.predicted_weekly_ads < l.latest_weekly_ads * 0.9 THEN 'MODERATE_DECLINE'\n              ELSE 'STABLE_VOLUME'\n            END as predicted_volume_trend,\n\n            -- Competitive forecast insights\n            RANK() OVER (PARTITION BY v.forecast_timestamp ORDER BY v.predicted_weekly_ads DESC) as predicted_volume_rank,\n            RANK() OVER (PARTITION BY v.forecast_timestamp ORDER BY COALESCE(a.predicted_aggressiveness, l.latest_avg_quality) DESC) as predicted_aggressiveness_rank\n\n          FROM volume_forecasts v\n          LEFT JOIN latest_actuals l ON v.brand = l.brand\n          LEFT JOIN aggressiveness_forecasts a ON v.brand = a.brand AND v.forecast_timestamp = a.forecast_timestamp\n          LEFT JOIN platform_forecasts p ON v.brand = p.brand AND v.forecast_timestamp = p.forecast_timestamp\n        ),\n\n        -- Add week-ahead competitive dynamics\n        competitive_forecast_analysis AS (\n          SELECT\n            *,\n\n            -- Forecast horizon analysis\n            DATE_DIFF(forecast_timestamp, CURRENT_DATE(), DAY) as days_ahead,\n            CASE\n              WHEN DATE_DIFF(forecast_timestamp, CURRENT_DATE(), DAY) <= 7 THEN 'WEEK_1'\n              WHEN DATE_DIFF(forecast_timestamp, CURRENT_DATE(), DAY) <= 14 THEN 'WEEK_2'\n              WHEN DATE_DIFF(forecast_timestamp, CURRENT_DATE(), DAY) <= 21 THEN 'WEEK_3'\n              ELSE 'WEEK_4'\n            END as forecast_horizon,\n\n            -- Strategic forecast alerts\n            CASE\n              WHEN predicted_volume_change_pct > 25 THEN 'HIGH_EXPANSION_ALERT'\n              WHEN predicted_volume_change_pct < -25 THEN 'HIGH_CONTRACTION_ALERT'\n              WHEN predicted_volume_rank <= 2 AND predicted_volume_change_pct > 10 THEN 'EMERGING_LEADER_ALERT'\n              WHEN predicted_aggressiveness_rank <= 2 THEN 'AGGRESSIVENESS_LEADER_ALERT'\n              ELSE 'NORMAL_FORECAST'\n            END as strategic_alert,\n\n            -- Confidence in predictions\n            CASE\n              WHEN confidence_level >= 0.95 THEN 'HIGH_CONFIDENCE'\n              WHEN confidence_level >= 0.80 THEN 'MEDIUM_CONFIDENCE'\n              ELSE 'LOW_CONFIDENCE'\n            END as forecast_confidence_level\n\n          FROM integrated_forecasts\n        )\n\n        SELECT\n          brand,\n          forecast_timestamp,\n          days_ahead,\n          forecast_horizon,\n\n          -- Current state\n          latest_weekly_ads as current_weekly_ads,\n          latest_avg_quality as current_avg_quality,\n          latest_platform_reach as current_platform_reach,\n\n          -- Predicted state\n          predicted_weekly_ads,\n          predicted_aggressiveness,\n          predicted_platform_reach,\n\n          -- Prediction intervals\n          ads_lower_bound,\n          ads_upper_bound,\n          aggressiveness_lower,\n          aggressiveness_upper,\n          platform_lower,\n          platform_upper,\n\n          -- Changes and trends\n          predicted_volume_change,\n          predicted_volume_change_pct,\n          predicted_volume_trend,\n\n          -- Competitive positioning\n          predicted_volume_rank,\n          predicted_aggressiveness_rank,\n\n          -- Strategic insights\n          strategic_alert,\n          forecast_confidence_level,\n\n          -- Forecast metadata\n          ROUND(confidence_level * 100, 1) as confidence_pct\n\n        FROM competitive_forecast_analysis\n        ORDER BY brand, forecast_timestamp\n        "
    },
    "signal_explorer_query": "\n        -- Intelligence Signal Explorer\n        WITH signal_metadata AS (\n            \n            SELECT \n                'Creative Intelligence' as module,\n                'Creative text length optimization needed - content is too brief for engagement - declining performan...' as insight_preview,\n                0.8 as confidence,\n                0.7 as business_impact,\n                'HIGH' as strength UNION ALL \n            SELECT \n                'Creative Intelligence' as module,\n                'Low brand mention frequency detected - increase brand presence in creative content - concerning down...' as insight_preview,\n                0.7 as confidence,\n                0.8 as business_impact,\n                'HIGH' as strength UNION ALL \n            SELECT \n                'Creative Intelligence' as module,\n                'Limited emotional language detected - incorporate more engaging emotional keywords...' as insight_preview,\n                0.6 as confidence,\n                0.6 as business_impact,\n                'HIGH' as strength UNION ALL \n            SELECT \n                'Creative Intelligence' as module,\n                'Content density optimization opportunity - enrich creative messaging...' as insight_preview,\n                0.5 as confidence,\n                0.5 as business_impact,\n                'MEDIUM' as strength\n        )\n        SELECT \n            module,\n            COUNT(*) as signal_count,\n            ROUND(AVG(confidence), 3) as avg_confidence,\n            ROUND(AVG(business_impact), 3) as avg_business_impact,\n            COUNT(CASE WHEN strength = 'CRITICAL' THEN 1 END) as critical_signals,\n            COUNT(CASE WHEN strength = 'HIGH' THEN 1 END) as high_signals\n        FROM signal_metadata  \n        GROUP BY module\n        ORDER BY signal_count DESC\n        ",
    "confidence_analysis_query": "\n        -- Confidence Analysis Across Data Sources\n        SELECT\n            brand,\n            COUNT(*) as total_data_points,\n            COUNT(CASE WHEN creative_text IS NOT NULL AND LENGTH(creative_text) > 10 THEN 1 END) as creative_data_points,\n            COUNT(CASE WHEN publisher_platforms IS NOT NULL THEN 1 END) as channel_data_points,\n            ROUND(COUNT(CASE WHEN creative_text IS NOT NULL AND LENGTH(creative_text) > 10 THEN 1 END) * 100.0 / COUNT(*), 2) as creative_coverage_pct,\n            ROUND(COUNT(CASE WHEN publisher_platforms IS NOT NULL THEN 1 END) * 100.0 / COUNT(*), 2) as channel_coverage_pct,\n            -- Data quality indicators\n            AVG(LENGTH(COALESCE(creative_text, ''))) as avg_text_richness,\n            COUNT(DISTINCT publisher_platforms) as platform_diversity,\n            ROUND((COUNT(CASE WHEN creative_text IS NOT NULL AND LENGTH(creative_text) > 10 THEN 1 END) + \n                   COUNT(CASE WHEN publisher_platforms IS NOT NULL THEN 1 END)) / (COUNT(*) * 2.0) * 100, 1) as overall_data_quality_score\n        FROM `bigquery-ai-kaggle-469620.ads_demo.ads_with_dates`\n        GROUP BY brand\n        ORDER BY total_data_points DESC\n        ",
    "module_performance_metrics": {
      "Creative Intelligence": {
        "signal_count": 4,
        "avg_confidence": 0.65,
        "avg_business_impact": 0.65
      }
    },
    "total_signals": 4,
    "filtered_noise_count": 0
  }
}